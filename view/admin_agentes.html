{include="header"}

<script type="text/javascript">
    $(document).ready(function() {
       if(window.location.hash.substring(1) == 'nuevo')
       {
          $("#modal_nuevo_agente").modal('show');
          document.f_nuevo_agente.nombre.focus();
       }
       else if(window.location.hash.substring(1) == 'modificar')
       {
          $("#modal_modificar_agente").modal('show');
          document.f_modificar_agente.nombre.focus();
       }

       $("#b_nuevo_agente").click(function(event) {
          event.preventDefault();
          $("#modal_nuevo_agente").modal('show');
          document.f_nuevo_agente.nombre.focus();
       });
    });
</script>

<div class="container-fluid">
    <div class="row">
       <div class="col-sm-6 col-xs-7">
          <div class="btn-group">
             <a class="btn btn-sm btn-default" href="{$fsc->url()}" title="Recargar la página">
                <span class="glyphicon glyphicon-refresh"></span>
             </a>
             {if="$fsc->page->is_default()"}
             <a class="btn btn-sm btn-default active" href="{$fsc->url()}&default_page=FALSE" title="Marcada como página de inicio (pulsa de nuevo para desmarcar)">
                <i class="fa fa-bookmark" aria-hidden="true"></i>
             </a>
             {else}
             <a class="btn btn-sm btn-default" href="{$fsc->url()}&default_page=TRUE" title="Marcar como página de inicio">
                <i class="fa fa-bookmark-o" aria-hidden="true"></i>
             </a>
             {/if}
          </div>
          <div class="btn-group">
             {loop="$fsc->extensions"}
                {if="$value->type=='button'"}
                <a href="index.php?page={$value->from}{$value->params}" class="btn btn-sm btn-default">{$value->text}</a>
                {/if}
             {/loop}
          </div>
       </div>
       <div class="col-sm-6 col-xs-5 text-right">
          <h2 style="margin-top: 0px;">Agentes</h2>
       </div>
    </div>
</div>

<div class="container-fluid" style="margin-top: 15px; margin-bottom: 10px;">
    <div class="row">
        <div class="col-sm-6">
            <a id="b_nuevo_agente" class="btn btn-xs btn-success" href="#">
                <span class="glyphicon glyphicon-plus"></span>
                <span class="hidden-xs">&nbsp;Nuevo</span>
            </a>
        </div>
        <div class="col-sm-6 text-right">
            <p class="help-block">
                <i class="fa fa-info-circle" aria-hidden="true"></i>&nbsp;
                Gestión de agentes/empleados del sistema.
            </p>
        </div>
    </div>
</div>

<div class="table-responsive">
    <table class="table table-hover">
        <thead>
            <tr>
                <th class="text-left">Código</th>
                <th class="text-left">Nombre</th>
                <th class="text-left">Apellidos</th>
                <th class="text-left">DNI/CIF</th>
                <th class="text-left">Email</th>
                <th class="text-left">Teléfono</th>
                <th class="text-left">Cargo</th>
                <th class="text-left">Ciudad</th>
                <th class="text-right">% Comisión</th>
                <th class="text-center">Acciones</th>
            </tr>
        </thead>
        {loop="$fsc->agente->all()"}
        <tr class='clickableRow' href='{$value->url()}'>
            <td><a href="{$value->url()}">{$value->codagente}</a></td>
            <td>{$value->nombre}</td>
            <td>{$value->apellidos}</td>
            <td>{$value->dnicif}</td>
            <td>{$value->email}</td>
            <td>{$value->telefono}</td>
            <td>{$value->cargo}</td>
            <td>{$value->ciudad}</td>
            <td class="text-right">{$value->porcomision}</td>
            <td class="text-center">
                <a href="{$value->url()}" class="btn btn-xs btn-default" title="Ver/Editar">
                    <span class="glyphicon glyphicon-edit"></span>
                </a>
                <a href="#" onclick="delete_agente('{$value->codagente}', '{$value->get_fullname()}')" class="btn btn-xs btn-danger" title="Eliminar">
                    <span class="glyphicon glyphicon-trash"></span>
                </a>
            </td>
        </tr>
        {else}
        <tr class="warning">
            <td colspan="10">Sin resultados.</td>
        </tr>
        {/loop}
    </table>
</div>

<div class="modal" id="modal_nuevo_agente">
    <div class="modal-dialog">
        <div class="modal-content">
            <form name="f_nuevo_agente" class="form" role="form" action="{$fsc->url()}" method="post">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title">
                        <i class="fa fa-user" aria-hidden="true"></i>&nbsp; Nuevo agente
                    </h4>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        Nombre:
                        <input class="form-control" type="text" name="nombre" maxlength="50" required=""/>
                    </div>
                    <div class="form-group">
                        Apellidos:
                        <input class="form-control" type="text" name="apellidos" maxlength="100" required=""/>
                    </div>
                    <div class="form-group">
                        DNI/CIF:
                        <input class="form-control" type="text" name="dnicif" maxlength="20"/>
                    </div>
                    <div class="form-group">
                        Email:
                        <div class="input-group">
                            <span class="input-group-addon">
                                <span class="glyphicon glyphicon-envelope"></span>
                            </span>
                            <input class="form-control" type="email" name="email"/>
                        </div>
                    </div>
                    <div class="form-group">
                        Teléfono:
                        <input class="form-control" type="tel" name="telefono" maxlength="20"/>
                    </div>
                    <div class="form-group">
                        Cargo:
                        <input class="form-control" type="text" name="cargo" maxlength="50"/>
                    </div>
                    <div class="form-group">
                        Dirección:
                        <textarea class="form-control" name="direccion" rows="2"></textarea>
                    </div>
                    <div class="row">
                        <div class="col-md-4">
                            <div class="form-group">
                                Código Postal:
                                <input class="form-control" type="text" name="codpostal" maxlength="10"/>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                Provincia:
                                <input class="form-control" type="text" name="provincia" maxlength="50"/>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                Ciudad:
                                <input class="form-control" type="text" name="ciudad" maxlength="50"/>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                Fecha de nacimiento:
                                <input class="form-control datepicker" type="text" name="f_nacimiento"/>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                Fecha de alta:
                                <input class="form-control datepicker" type="text" name="f_alta"/>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                Fecha de baja:
                                <input class="form-control datepicker" type="text" name="f_baja"/>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                % Comisión:
                                <input class="form-control" type="number" step="0.01" name="porcomision"/>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        Nº Seguridad Social:
                        <input class="form-control" type="text" name="seg_social" maxlength="20"/>
                    </div>
                    <div class="form-group">
                        Cuenta bancaria:
                        <input class="form-control" type="text" name="banco" maxlength="50"/>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-sm btn-primary" type="submit">
                        <span class="glyphicon glyphicon-floppy-disk"></span>&nbsp; Guardar
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

{if="$fsc->modificar"}
<div class="modal" id="modal_modificar_agente">
    <div class="modal-dialog">
        <div class="modal-content">
            <form name="f_modificar_agente" class="form" role="form" action="{$fsc->url()}" method="post">
                <input type="hidden" name="codagente" value="{$fsc->agente->codagente}"/>
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title">
                        <i class="fa fa-edit" aria-hidden="true"></i>&nbsp; Modificar agente {$fsc->agente->codagente}
                    </h4>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        Nombre:
                        <input class="form-control" type="text" name="nombre" maxlength="50" value="{$fsc->agente->nombre}" required=""/>
                    </div>
                    <div class="form-group">
                        Apellidos:
                        <input class="form-control" type="text" name="apellidos" maxlength="100" value="{$fsc->agente->apellidos}" required=""/>
                    </div>
                    <div class="form-group">
                        DNI/CIF:
                        <input class="form-control" type="text" name="dnicif" maxlength="20" value="{$fsc->agente->dnicif}"/>
                    </div>
                    <div class="form-group">
                        Email:
                        <div class="input-group">
                            <span class="input-group-addon">
                                <span class="glyphicon glyphicon-envelope"></span>
                            </span>
                            <input class="form-control" type="email" name="email" value="{$fsc->agente->email}"/>
                        </div>
                    </div>
                    <div class="form-group">
                        Teléfono:
                        <input class="form-control" type="tel" name="telefono" maxlength="20" value="{$fsc->agente->telefono}"/>
                    </div>
                    <div class="form-group">
                        Cargo:
                        <input class="form-control" type="text" name="cargo" maxlength="50" value="{$fsc->agente->cargo}"/>
                    </div>
                    <div class="form-group">
                        Dirección:
                        <textarea class="form-control" name="direccion" rows="2">{$fsc->agente->direccion}</textarea>
                    </div>
                    <div class="row">
                        <div class="col-md-4">
                            <div class="form-group">
                                Código Postal:
                                <input class="form-control" type="text" name="codpostal" maxlength="10" value="{$fsc->agente->codpostal}"/>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                Provincia:
                                <input class="form-control" type="text" name="provincia" maxlength="50" value="{$fsc->agente->provincia}"/>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                Ciudad:
                                <input class="form-control" type="text" name="ciudad" maxlength="50" value="{$fsc->agente->ciudad}"/>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                Fecha de nacimiento:
                                <input class="form-control datepicker" type="text" name="f_nacimiento" value="{$fsc->agente->f_nacimiento}"/>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                Fecha de alta:
                                <input class="form-control datepicker" type="text" name="f_alta" value="{$fsc->agente->f_alta}"/>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                Fecha de baja:
                                <input class="form-control datepicker" type="text" name="f_baja" value="{$fsc->agente->f_baja}"/>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                % Comisión:
                                <input class="form-control" type="number" step="0.01" name="porcomision" value="{$fsc->agente->porcomision}"/>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        Nº Seguridad Social:
                        <input class="form-control" type="text" name="seg_social" maxlength="20" value="{$fsc->agente->seg_social}"/>
                    </div>
                    <div class="form-group">
                        Cuenta bancaria:
                        <input class="form-control" type="text" name="banco" maxlength="50" value="{$fsc->agente->banco}"/>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-sm btn-primary" type="submit">
                        <span class="glyphicon glyphicon-floppy-disk"></span>&nbsp; Guardar cambios
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{/if}

<script type="text/javascript">
function delete_agente(codagente, nombre) {
    bootbox.confirm({
        title: 'Eliminar agente',
        message: '¿Estás seguro de que quieres eliminar el agente <b>' + nombre + '</b>?',
        confirm: function(result) {
            if (result) {
                window.location.href = '{$fsc->url()}&delete=' + codagente;
            }
        }
    });
}
</script>

{include="footer"}