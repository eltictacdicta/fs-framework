{{ include('header.html.twig') }}

<script type="text/javascript">
   $(document).ready(function() {
      if(window.location.hash.substring(1) == 'nuevo')
      {
         $("#modal_nuevo_departamento").modal('show');
         document.f_nuevo_departamento.nnombre.focus();
      }
      $("#b_nuevo_departamento").click(function(event) {
         event.preventDefault();
         $("#modal_nuevo_departamento").modal('show');
         document.f_nuevo_departamento.nnombre.focus();
      });
   });
</script>

<div class="container-fluid">
   <div class="row">
      <div class="col-sm-6 col-xs-7">
         <div class="btn-group">
            <a class="btn btn-sm btn-default" href="{{ fsc.url() }}" title="Recargar la página">
               <span class="glyphicon glyphicon-refresh"></span>
            </a>
            {% if fsc.page.is_default() %}
            <a class="btn btn-sm btn-default active" href="{{ fsc.url() }}&default_page=FALSE" title="Marcada como página de inicio (pulsa de nuevo para desmarcar)">
               <i class="fa fa-bookmark" aria-hidden="true"></i>
            </a>
            {% else %}
            <a class="btn btn-sm btn-default" href="{{ fsc.url() }}&default_page=TRUE" title="Marcar como página de inicio">
               <i class="fa fa-bookmark-o" aria-hidden="true"></i>
            </a>
            {% endif %}
         </div>
         <div class="btn-group">
            {% for value in fsc.extensions %}
               {% if value.type == 'button' %}
               <a href="index.php?page={{ value.from }}{{ value.params }}" class="btn btn-sm btn-default">{{ value.text }}</a>
               {% endif %}
            {% endfor %}
         </div>
      </div>
      <div class="col-sm-6 col-xs-5 text-right">
         <h2 style="margin-top: 0px;">
            <i class="fa fa-building" aria-hidden="true"></i> Departamentos
         </h2>
      </div>
   </div>
</div>

<div class="container-fluid" style="margin-top: 15px; margin-bottom: 10px;">
   <div class="row">
      <div class="col-sm-6">
         <a id="b_nuevo_departamento" class="btn btn-xs btn-success" href="#">
            <span class="glyphicon glyphicon-plus"></span>
            <span class="hidden-xs">&nbsp;Nuevo departamento</span>
         </a>
      </div>
      <div class="col-sm-6 text-right">
         <p class="help-block">
            <i class="fa fa-info-circle" aria-hidden="true"></i>&nbsp;
            Los departamentos permiten agrupar usuarios y asignar administradores
            para cada grupo.
         </p>
      </div>
   </div>
</div>

<div class="table-responsive">
   <table class="table table-hover">
      <thead>
         <tr>
            <th>Código</th>
            <th>Nombre</th>
            <th>Descripción</th>
            <th class="text-center">Usuarios</th>
            <th class="text-center">Admins</th>
            <th class="text-center">Estado</th>
            <th class="text-right">Fecha alta</th>
         </tr>
      </thead>
      {% for value in fsc.all_departamentos() %}
      <tr class="clickableRow{% if not value.activo %} warning{% endif %}" href="{{ value.url() }}">
         <td>
            <a href="{{ value.url() }}">{{ value.coddepartamento }}</a>
         </td>
         <td>{{ value.nombre }}</td>
         <td>{{ value.descripcion }}</td>
         <td class="text-center">
            <span class="badge">{{ value.count_users() }}</span>
         </td>
         <td class="text-center">
            <span class="badge badge-warning">{{ value.count_admins() }}</span>
         </td>
         <td class="text-center">
            {% if value.activo %}
            <span class="label label-success">Activo</span>
            {% else %}
            <span class="label label-default">Inactivo</span>
            {% endif %}
         </td>
         <td class="text-right">{{ value.fecha_alta }}</td>
      </tr>
      {% else %}
      <tr class="warning">
         <td colspan="7">No hay departamentos. Crea uno nuevo para empezar.</td>
      </tr>
      {% endfor %}
   </table>
</div>

<div class="modal" id="modal_nuevo_departamento">
   <div class="modal-dialog">
      <div class="modal-content">
         <form name="f_nuevo_departamento" class="form" role="form" action="{{ fsc.url() }}" method="post">
            {{ csrf_field() }}
            <div class="modal-header">
               <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
               <h4 class="modal-title">
                  <i class="fa fa-building" aria-hidden="true"></i>&nbsp; Nuevo departamento
               </h4>
            </div>
            <div class="modal-body">
               <div class="form-group">
                  Nombre:
                  <input type="text" name="nnombre" class="form-control" maxlength="100" autocomplete="off" required=""/>
               </div>
               <div class="form-group">
                  Descripción:
                  <textarea name="ndescripcion" class="form-control" rows="3" maxlength="500"></textarea>
               </div>
               <p class="help-block">
                  <i class="fa fa-info-circle" aria-hidden="true"></i>
                  El código del departamento se generará automáticamente.
               </p>
            </div>
            <div class="modal-footer">
               <button class="btn btn-sm btn-primary" type="submit">
                  <span class="glyphicon glyphicon-floppy-disk"></span>&nbsp; Guardar
               </button>
            </div>
         </form>
      </div>
   </div>
</div>

{{ include('footer.html.twig') }}
