{#
/**
 * This file is part of FSFramework
 * Copyright (C) 2025 Javier Trujillo <mistertekcom@gmail.com>
 *
 * Utility macros for common template operations
 */
#}

{#
 * Render alert messages based on type
 * @param array messages - List of messages/logs
 * @param array types - Message types to display (error, warning, notice, info)
 * @param string alertClass - Bootstrap alert class (danger, warning, success, info)
 #}
{% macro message(messages, types, alertClass) %}
    {% set filteredMessages = [] %}
    {% for msg in messages %}
        {% if msg.level is defined and msg.level in types %}
            {% set filteredMessages = filteredMessages|merge([msg]) %}
        {% elseif msg is not iterable %}
            {% set filteredMessages = filteredMessages|merge([msg]) %}
        {% endif %}
    {% endfor %}
    
    {% if filteredMessages|length > 0 %}
    <div class="alert alert-{{ alertClass }} alert-dismissible" role="alert">
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
        <ul class="mb-0 list-unstyled">
        {% for msg in filteredMessages %}
            <li>{% if msg.message is defined %}{{ msg.message|raw }}{% else %}{{ msg|raw }}{% endif %}</li>
        {% endfor %}
        </ul>
    </div>
    {% endif %}
{% endmacro %}

{#
 * Render a simple list of messages
 * @param array messages - List of messages
 * @param string alertClass - Bootstrap alert class
 #}
{% macro simpleMessages(messages, alertClass) %}
    {% if messages|length > 0 %}
    <div class="alert alert-{{ alertClass }} alert-dismissible" role="alert">
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
        <ul class="mb-0 list-unstyled">
        {% for msg in messages %}
            <li>{{ msg|raw }}</li>
        {% endfor %}
        </ul>
    </div>
    {% endif %}
{% endmacro %}

{#
 * Render page title with optional icon and actions
 * @param string title - Page title
 * @param string icon - Font Awesome icon class (without fa prefix)
 * @param string subtitle - Optional subtitle
 #}
{% macro pageTitle(title, icon, subtitle) %}
<div class="page-header">
    <h1>
        {% if icon %}<i class="fa fa-{{ icon }}" aria-hidden="true"></i> {% endif %}
        {{ title }}
        {% if subtitle %}<small>{{ subtitle }}</small>{% endif %}
    </h1>
</div>
{% endmacro %}

{#
 * Render a panel/card with header and body
 * @param string title - Panel title
 * @param string type - Panel type (default, primary, success, info, warning, danger)
 * @param string icon - Optional icon
 #}
{% macro panelStart(title, type, icon) %}
<div class="panel panel-{{ type|default('default') }}">
    <div class="panel-heading">
        <h3 class="panel-title">
            {% if icon %}<i class="fa fa-{{ icon }}" aria-hidden="true"></i> {% endif %}
            {{ title }}
        </h3>
    </div>
    <div class="panel-body">
{% endmacro %}

{% macro panelEnd() %}
    </div>
</div>
{% endmacro %}

{#
 * Render a card (Bootstrap 5 style mapped to Bootstrap 3)
 * @param string title - Card title
 * @param string headerClass - Optional header background class
 #}
{% macro cardStart(title, headerClass) %}
<div class="card shadow mb-4">
    {% if title %}
    <div class="card-header{% if headerClass %} {{ headerClass }}{% endif %}">
        <h3 class="h5 mb-0">{{ title }}</h3>
    </div>
    {% endif %}
    <div class="card-body">
{% endmacro %}

{% macro cardEnd(footerContent) %}
    </div>
    {% if footerContent %}
    <div class="card-footer p-2">
        {{ footerContent|raw }}
    </div>
    {% endif %}
</div>
{% endmacro %}

{#
 * Render a button with icon
 * @param string label - Button label
 * @param string icon - Font Awesome icon
 * @param string type - Button type (primary, success, danger, etc.)
 * @param string href - Optional link URL
 * @param string onclick - Optional onclick handler
 * @param boolean spin - Add btn-spin-action class
 #}
{% macro button(label, icon, type, href, onclick, spin) %}
{% if href %}
<a href="{{ href }}" class="btn btn-{{ type|default('default') }}{% if spin %} btn-spin-action{% endif %}"{% if onclick %} onclick="{{ onclick }}"{% endif %}>
    {% if icon %}<i class="fa fa-{{ icon }} me-2"></i>{% endif %}{{ label }}
</a>
{% else %}
<button type="button" class="btn btn-{{ type|default('default') }}{% if spin %} btn-spin-action{% endif %}"{% if onclick %} onclick="{{ onclick }}"{% endif %}>
    {% if icon %}<i class="fa fa-{{ icon }} me-2"></i>{% endif %}{{ label }}
</button>
{% endif %}
{% endmacro %}

{#
 * Render a submit button with icon
 * @param string label - Button label
 * @param string icon - Font Awesome icon
 * @param string type - Button type (primary, success, etc.)
 * @param boolean spin - Add btn-spin-action class
 #}
{% macro submitButton(label, icon, type, spin) %}
<button type="submit" class="btn btn-{{ type|default('primary') }}{% if spin %} btn-spin-action{% endif %}">
    {% if icon %}<i class="fa fa-{{ icon }} me-2"></i>{% endif %}{{ label }}
</button>
{% endmacro %}

{#
 * Render loading spinner
 #}
{% macro spinner() %}
<div class="text-center">
    <i class="fa fa-spinner fa-spin fa-2x"></i>
</div>
{% endmacro %}

{#
 * Render empty state message
 * @param string message - Message to display
 * @param string icon - Optional icon
 #}
{% macro emptyState(message, icon) %}
<div class="text-center text-muted py-5">
    {% if icon %}<i class="fa fa-{{ icon }} fa-3x mb-3"></i><br/>{% endif %}
    <p>{{ message }}</p>
</div>
{% endmacro %}

{#
 * Format bytes to human readable size
 * @param int bytes - Size in bytes
 * @param int precision - Decimal precision
 #}
{% macro formatBytes(bytes, precision) %}
{% set units = ['B', 'KB', 'MB', 'GB', 'TB'] %}
{% set bytes = bytes|default(0) %}
{% set precision = precision|default(2) %}
{% set pow = 0 %}
{% if bytes > 0 %}
    {% set pow = (bytes|log / 1024|log)|floor %}
    {% if pow > 4 %}{% set pow = 4 %}{% endif %}
{% endif %}
{{ (bytes / (1024 ** pow))|round(precision) }} {{ units[pow] }}
{% endmacro %}
